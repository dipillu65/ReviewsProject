<html>
    <head>
      <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>\
      <script type="text/javascript" src="./db.js"></script>
    </head>

    <body>
        <h1>Review Analyzer</h1>
        <select id="selectBook" onchange="displayData()">
                <option>Choose a book</option>
        </select>
      <table class="columns">
        <tr>
          <td><div id="chart_div" style="border: 1px solid #ccc"></div></td>
          <td><div id="table_div" style="border: 1px solid #ccc"></div></td>
        </tr>
      </table>
    </body>

<script>  
google.charts.load('current', {packages: ['corechart']});
google.charts.load('current', {packages:['table']});
google.charts.setOnLoadCallback(drawBasic);
google.charts.setOnLoadCallback(drawTable);


//OBTAIN SENTIMENT SCORE AND ASIN FOR CHART
var sentiments = reviews.map((element)=>{
  date = new Date (element.date);
  return [date, element.score];
})
sentiments = sentiments.sort((a,b) => {return a[0]-b[0]});

//POPULATE DROPDOWN
var select = document.getElementById("selectBook");
var Ids = [];   
reviews.forEach( reviews => {
  Ids.push(reviews.asin);
})  
UniqueIds = [...new Set(Ids)]
//Loop through UniqueIds array and populate dropdown
for(var i = 0; i < UniqueIds.length; i++){
  var opt = UniqueIds[i];
  var el = document.createElement("option");
  el.textContent = opt; //define text content of element to be UniqueIds elements
  el.value = opt;
  select.appendChild(el)
}

var chart;
var options;
//DRAW CHART
function drawBasic() {
  var data = new google.visualization.DataTable();
  data.addColumn('date', 'X');
  data.addColumn('number', 'Product');
  data.addRows(sentiments);
  console.log(sentiments)

  options = {
    chart: {
      title: 'Sentiment',
      subtitle: 'in millions of dollars (USD)'
    },
    width: 1000,
    height: 500,
    hAxis: {
      title: 'Date'
    },
    vAxis: {
      title: 'Sentiment'
    },
    colors: ['#AB0D06', '#007329'],
    trendlines: {
      0: {type: 'linear', color: '#111', opacity: .3}
    },
  
  };

  chart = new google.visualization.LineChart(document.getElementById('chart_div'));

  chart.draw(data, options);
}

//UPDATE CHART
function displayData(){
var results = [];
  //Get selected option from dropdown
  var selectedID = document.getElementById('selectBook').options[document.getElementById('selectBook').selectedIndex].value;
  //Function to filter out revelant data from json file
 console.log(selectedID);
 reviews.forEach(item => {
   if (item.asin == selectedID){
     var element = [new Date (item.date),item.score]
     results.push(element)
   }
 })
 results = results.sort((a,b) => {return a[0]-b[0]});
 console.log(results)
 var data = new google.visualization.DataTable();
  data.addColumn('date', 'X');
  data.addColumn('number', 'Product');
  data.addRows(results);



  chart.draw( data, options);
}

//DRAW SENTIMENT TABLE
function drawTable() {
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Entity');
        data.addColumn('number', 'Popularity');
        data.addColumn('boolean', 'Sentiment');
        data.addRows([
          ['Mike',  {v: 10000, f: '$10,000'}, true],
          ['Jim',   {v:8000,   f: '$8,000'},  false],
          ['Alice', {v: 12500, f: '$12,500'}, true],
          ['Alice', {v: 12500, f: '$12,500'}, true],
          ['Alice', {v: 12500, f: '$12,500'}, true],
          ['Alice', {v: 12500, f: '$12,500'}, true],
          ['Alice', {v: 12500, f: '$12,500'}, true],
          ['Alice', {v: 12500, f: '$12,500'}, true],
          ['Alice', {v: 12500, f: '$12,500'}, true],
          ['Alice', {v: 12500, f: '$12,500'}, true],
          ['Bob',   {v: 7000,  f: '$7,000'},  true]
        ]);

        var option = {
      title: 'Entities',
        width: 300,
        height: 500
      };
        var table = new google.visualization.Table(document.getElementById('table_div'));

        table.draw(data, option);
    }

</script>
</html>
  